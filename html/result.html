<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no"/>
    <title>诺禾致源</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/loadSimple.css">
    <link rel="stylesheet" href="../css/ionicons.min.css">
    <style>
        body {
            background: #eeeeee;
        }
    </style>
<body>
<div id='app'>
    <nuohe-header></nuohe-header>

    <div id='result'>

        <!-- 整个标题加上菜单 -->
        <div class='resultTitle'>
            {{menuArray[abilityId]}}详情
            <span class='menuBtn ion-navicon' @click='menuToggle'></span>
            <div class='menuListUl' v-show='ifMenuShow'>
                <template v-for='(item,index) in menuArray'>
                    <div @click='changeMenu($event,index)' class='menuListLi' :class="(index==abilityId)?'current':'' ">
                        {{item}}能力
                    </div>
                </template>
            </div>
        </div>

        <!-- dataTable和peityCircle 的components -->
        <result-ability
                v-for='(item,index) in resultAbility'
                :index="index"
                :key="index"
                :ability-name="item.abilityName"
                :ability-result="item.abilityResult"
                :data-table="item.dataTable"
                :your-score="item.yourScore"
                :chinese-score="item.chineseScore">
        </result-ability>

        <!-- 蜂巢加轮播 -->
        <result-guide v-for='(item,index) in resultGuide'
                      :index="index"
                      :key="index"
                      :honey-comb-array="item.honeyCombArray"
                      :product-array="item.productArray"
                      :advise-other-array="item.adviseOtherArray"
        >
        </result-guide>

        <!-- 机理 -->
        <result-principle v-for='(item,index) in resultPrinciple'
                          :index="index"
                          :key="index"
                          :p-array="item.pArray">
        </result-principle>
    </div>

    <div id='footerBtns'>
        <span @click='toLeft($event)' class='toLeft' v-if='abilityId>0'><i class='ion-chevron-left'></i>{{menuArray[abilityId-1]}}能力</span>
        <span @click='toRight($event)' class='toRight' v-if='abilityId<menuArray.length-1'>
            {{menuArray[parseInt(abilityId)+1]}}能力<i class='ion-chevron-right'></i></span>
        <div style='clear: both;'></div>
    </div>
</div>


<script src='../js/vue.min.js'></script>
<script src='../js/jquery.min.js'></script>
<script src='../js/fastclick.js'></script>
<script src='../js/require.min.js'></script>
<script src='../js/controller.js'></script>
<script src='../js/jquery.peity.min.js'></script>
<script>
    $(function () {
        window.searchJson = searchJson = window.location.search.searchToJson();
        if (!window.searchJson.id) window.location.search = 'id=0';//默认抗敏感能力...
        FastClick.attach(document.body);


        window.BUS = new Vue({});

        var vm = new Vue({
            el: '#app',
            data: {
                abilityId: 0,
                ifMenuShow: false,
                menuArray: [],


                resultAbility: [],
                resultGuide: [],
                resultPrinciple: [],
            },
            methods: {
                menuToggle: function () {
                    this.ifMenuShow = !this.ifMenuShow;
                },
                changeMenu: function (e, index) {
                    location.href = 'result.html?id=' + index;
                },
                toLeft: function () {
                    var that = this;
                    that.changeMenu(null, parseInt(that.abilityId) - 1);
                },
                toRight: function () {
                    var that = this;
                    that.changeMenu(null, parseInt(that.abilityId) + 1);
                },
            },
            components: {
                'nuohe-header': function (resolve) {
                    require(['../components/nuoheHeader.js'],
                        function () {
                            resolve(nuoheHeader);
                        })
                },
                'result-ability': function (resolve) {
                    require(['../components/resultAbility.js'],
                        function () {
                            resolve(resultAbility);
                        })
                },
                'result-guide': function (resolve) {
                    require(['../components/resultGuide.js'],
                        function () {
                            resolve(resultGuide);
                        })
                },
                'result-principle': function (resolve) {
                    require(['../components/resultPrinciple.js'],
                        function () {
                            resolve(resultPrinciple);
                        })
                },
            },
            created: function () {
                var that = this;

                //根据url更新全局索引...
                this.abilityId = searchJson.id;

                //init ability...
                controller.direct({php: '../json/ability.json'}, function (json) {
                    that.menuArray = json.data;
                });

                //init result...
                controller.direct({php: '../json/result.json', params: {abilityId: searchJson.id}}, function (json) {
                    that.resultAbility = json.data.resultAbility;
                    that.resultGuide = json.data.resultGuide;
                    that.resultPrinciple = json.data.resultPrinciple;
                });

            },
            mounted: function () {
                var that = this;
            }
        });

        window.vm = vm;


    })
</script>
</body>
</html>